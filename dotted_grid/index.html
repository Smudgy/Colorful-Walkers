<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title></title>
  <style>
  canvas {
    position: absolute;
    top: 0;
    left: 0;
  }

  </style>

</head>

<body>
  <script src="p5.js"></script>
  <script>
  //onload + audiolistener function

  // window.onload = function() {
  //   window.wallpaperRegisterAudioListener(wallpaperAudioListener);
  // };
  //
  // window.wallpaperPropertyListener = {
  //   applyUserProperties: function(properties) {
  //
  //   }
  // };
  //
  // let arr = []; //matrix to avoid stuttering/flickering
  // function wallpaperAudioListener(audioArray) {
  //   let normalise = audioArray.slice(0, 32).concat(audioArray.slice(64, 64 + 32)); //more frequencies means less bass interaction/ more stops on tremble (32-48)
  //   // let normalise = audioArray;
  //   let threshold = audioArray.slice(0, 16).concat(audioArray.slice(64, 64 + 16));
  //
  //   if (Math.max.apply(Math, threshold) > 0.02) {
  //     let ratio = Math.max.apply(Math, normalise);
  //     for (i = 0; i < audioArray.length; i++) {
  //       audioArray[i] /= ratio;
  //     }
  //   }
  //
  //   let lowFreqs = audioArray.slice(0, 5).concat(audioArray.slice(64, 64 + 5));
  //   let sum = lowFreqs.reduce((a, b) => a + b, 0);
  //   let bass = sum / lowFreqs.length;
  //
  //   if (arr[0] && arr[1]) {
  //     arr[1] = arr[0];
  //     arr[0] = bass;
  //     AverageLowFreq = arr[0] * 0.67 + arr[1] * 0.33;
  //   } else if (arr[0]) {
  //     arr[1] = arr[0];
  //     arr[0] = bass;
  //     AverageLowFreq = arr[0];
  //   } else {
  //     arr[0] = bass;
  //     AverageLowFreq = arr[0];
  //   }
  //
  //   if (AverageLowFreq < 0.05) {
  //     AverageLowFreq = 0;
  //   }
  // };

  let w = window.innerWidth;
  let h = window.innerHeight;

  let tick = 0.0;

  let dots = [];
  let n = 30;

  class Dot {
    constructor(x, y) {
      this.v1 = createVector(x,y);
    }

    show() {
      //let d = dist(this.v1.x, this.v1.y, mouseX, mouseY);
      let v2 = createVector(mouseX - this.v1.x, mouseY - this.v1.y);
      let d = v2.mag();
      v2.normalize();

      let d1 = map(d, 0, 1000, 1.0, 0, true);
      let d2 = map(d, 0, 500, 1.0, 0, true);

      noStroke();
      fill(255, 255, 255, 50 + 100 * d2);
      ellipse(this.v1.x - d2 * 25 * v2.x, this.v1.y - d2 * 25 * v2.y, 15 + 25 * d1, 15 + 25 * d1);
    }
  };

  function setup() {
    createCanvas(w, h);
    let swtch = w/(4*n);

    for (let y = 0; y < h; y += w/n) {
      for (let x = swtch; x < w; x += w/n) {
        dots.push(new Dot(x, y));
      }
      swtch *= -1;
    }
  }

  function draw() {
    background(50);
    for (let i = 0; i < dots.length; i++) {
      dots[i].show();
    }
    tick += 0.1;
    let v3 = createVector( sin(tick), cos(tick) );
    v3.mult(10);

    noStroke();
    fill(255, 255, 255, 150);
    ellipse(mouseX - v3.x, mouseY + v3.y, 10, 10);
    ellipse(mouseX + v3.x, mouseY - v3.y, 10, 10);
  }

  window.addEventListener('resize', function() {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
    // ctx.globalCompositeOperation = 'source-over';
    // ctx.fillStyle = 'rgb(20, 20, 20)';
    // ctx.fillRect( 0, 0, w, h );
  })

  </script>
</body>

</html>

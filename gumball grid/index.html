<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title></title>
  <style>
  canvas {
    position: absolute;
    top: 0;
    left: 0;
  }

  </style>

</head>

<body>
  <script src="js/p5.js"></script>
  <script src="js/varInit.js"></script>
  <script>

  // Dot class

  class Dot {
    constructor(x, y) {
      this.v1 = createVector(x,y);
    }

    show() {
      let v2 = createVector(mouseX - this.v1.x, mouseY - this.v1.y);
      let d = v2.mag();
      v2.normalize();

      let radius = Math.max( rad1 * pow(map(d, 0, radd, 0, 1.0, true), 1 / radp) + rad2 * pow(map(d, 0, radd, 1.0, 0, true), radp), 0 );
      let roundoff = Math.max( ( rou1 * pow(map(d, 0, roud, 0, 1.0, true), 1 / roup) + rou2 * pow(map(d, 0, roud, 1.0, 0, true), roup)) * radius / 200, 0 );
      let shift = sh1 * pow(map(d, 0, shd, 0, 1.0, true), 1 / shp) + sh2 * pow(map(d, 0, shd, 1.0, 0, true), shp);
      let rotation = rot1 * pow(map(d, 0, rotd, 0, 1.0, true), 1 / rotp) + rot2 * pow(map(d, 0, rotd, 1.0, 0, true), rotp) + rotLoop * frameCount;

      let hue = ( hue1 * pow(map(d, 0, hued, 0, 1.0, true), 1 / huep) + hue2 * pow(map(d, 0, hued, 1.0, 0, true), huep) + hueLoop * frameCount ) % 360;
      let sat = sat1 * pow(map(d, 0, satd, 0, 1.0, true), 1 / satp) + sat2 * pow(map(d, 0, satd, 1.0, 0, true), satp );
      let lum = lum1 * pow(map(d, 0, lumd, 0, 1.0, true), 1 / lump) + lum2 * pow(map(d, 0, lumd, 1.0, 0, true), lump );
      let alpha = a1 * pow(map(d, 0, ad, 0, 1.0, true), 1 / ap) + a2 * pow(map(d, 0, ad, 1.0, 0, true), ap);


      noStroke();

      push();
      colorMode(HSB);
      translate(this.v1.x - shift * v2.x, this.v1.y - shift * v2.y);
      rotate( rotation );
      fill( hue, sat, lum, alpha );
      rect(0, 0, radius, radius, roundoff);
      pop();
    }
  };

  // p5 setup() and draw()

  function setup() {
    createCanvas(w, h);
    angleMode(DEGREES);
    rectMode(CENTER);

    let bound = Math.abs(sh1) + Math.abs(sh2);

    for (let y = -bound; y < h + bound; y += w/n) {
      for (let x = -swtch - bound; x < w - swtch + bound; x += w/n) {
        dots.push(new Dot(x, y));
      }
      swtch *= -1;
    }
  }

  function draw() {
    push();
    colorMode(HSB);
    background(200, 30, 10);
    pop();

    for (let i = 0; i < dots.length; i++) {
      dots[i].show();
    }
  }

  // resize function

  window.addEventListener('resize', function() {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
    dots = [];
    setup();
  })

  </script>
</body>

</html>
